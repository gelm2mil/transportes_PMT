<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Panel Administrativo – Denuncias PMT</title>
<link rel="stylesheet" href="styles.css">

<style>
/* TABLA NEÓN */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 14px;
}

th, td {
  padding: 10px;
  text-align: left;
  border: 1px solid #00ffc8;
}

th {
  background: #00ffc8;
  color: #000;
}

td {
  background: #0a0f1f;
  color: #cfcfcf;
}

tr:hover td {
  background: rgba(0,255,255,0.12);
}

.btn-atendida {
  padding: 6px 12px;
  border-radius: 8px;
  background: #00ff88;
  color: #000;
  font-weight: bold;
  cursor: pointer;
  border: none;
}

.btn-atendida:hover {
  filter: brightness(1.15);
}

/* BUSCADOR */
#buscador {
  width: 100%;
  padding: 10px;
  margin-bottom: 10px;
  border-radius: 10px;
  border: 1px solid #00ffc8;
  background: #050513;
  color: #00ffc8;
}

</style>
</head>

<body>

<div class="contenedor">

  <div class="header-top">
    <div class="logo-box"><img src="icons/icon-192.png" alt="PMT"></div>
    <div class="titulos">
      <div class="titulos-linea1">PANEL ADMINISTRATIVO</div>
      <div class="titulos-linea2">Denuncias Ciudadanas – PMT Chimaltenango</div>
      <div class="titulos-linea3">Gestión de denuncias enviadas por la comunidad</div>
    </div>
    <div class="logo-box"><img src="icons/icon-512.png" alt="GELM"></div>
  </div>

  <a href="index.html" class="btn-volver">⬅ Volver al inicio</a>

  <h3 style="color:#00ffc8; margin-top:20px;">Buscar denuncia por placa</h3>
  <input type="text" id="buscador" placeholder="Escriba placa para filtrar..." oninput="filtrarTabla()">

  <div id="tablaDenuncias"></div>

  <div class="pie" style="margin-top:22px;">
    2014 - 2025 | BY GELM | Delegación de Transportes PMT — Chimaltenango<br>
    Panel administrativo de denuncias ciudadanas<br>
    <div id="pie-fecha"></div>
  </div>

</div>

<script>
const SHEET_ID = "1Hb4WJWYB-7uRRSFnHEgp2-tc_PtiHA-0M30n41HDf4o";
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbypncaQPe-4i8md4SqTrmxdXclW6bb-6RtJaL8Sc8RnM1wFBJHnwqHGG4f5WKBdEDx_fw/exec";

// Cargar fecha pie
document.getElementById("pie-fecha").innerText =
  new Date().toLocaleString('es-GT', { dateStyle:'full', timeStyle:'short' });

// Cargar denuncias
fetch(`${SCRIPT_URL}?sheet=${SHEET_ID}`)
  .then(res => res.json())
  .then(data => {
    renderTabla(data);
  })
  .catch(err => {
    document.getElementById("tablaDenuncias").innerHTML =
      "<p style='color:#f55;'>Error al cargar denuncias. Compruebe el script/Sheet.</p>";
  });

// Renderizar tabla
function renderTabla(items) {
  let html = `
    <table>
      <thead>
        <tr>
          <th>Fecha</th><th>Hora</th><th>Placa</th>
          <th>Tipo</th><th>Problema</th><th>Ubicación</th>
          <th>Contacto</th><th>Estado</th><th>Acción</th>
        </tr>
      </thead><tbody>`;
  
  items.forEach((item, idx) => {
    html += `
      <tr data-placa="${item.placa}">
        <td>${item.fecha}</td>
        <td>${item.hora}</td>
        <td>${item.placa}</td>
        <td>${item.tipo}</td>
        <td>${item.problema}</td>
        <td>${item.ubicacion}</td>
        <td>${item.contacto}</td>
        <td id="estado-${idx}">${item.estado}</td>
        <td><button class="btn-atendida" onclick="marcarAtendida(${idx})">Atendida</button></td>
      </tr>`;
  });

  html += "</tbody></table>";

  document.getElementById("tablaDenuncias").innerHTML = html;
}

// Marcar como atendida (solo visual)
function marcarAtendida(i) {
  document.getElementById("estado-" + i).innerText = "Atendida";
}

// Filtrar por placa
function filtrarTabla(){
  const filtro = document.getElementById("buscador").value.toUpperCase();
  const filas = document.querySelectorAll("#tablaDenuncias table tbody tr");
  
  filas.forEach(f => {
    const placa = f.getAttribute("data-placa").toUpperCase();
    f.style.display = placa.includes(filtro) ? "" : "none";
  });
}
</script>

</body>
</html>
